<!doctype html>
<title>Class Survey</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  @media (min-width: 601px) {
    body {
      width: 600px;
      margin: 8px auto;
    }
  }

  img { width: 100%; }

  input:user-invalid {
    border: 2px solid red;
  }

  .invalid {
    outline: 2px solid red;
  }

  .cols-fr1fr3 {
    margin-top: 1em;
    display: grid;
    grid: auto-flow / 1fr 3fr;
    gap: 5px;
    align-items: flex-end;
  }
</style>

<form action="/api/1/post" method="post">

  <div class="cols-fr1fr3">
    <label for="name">Name:</label>
    <input name="name" id="name"
           pattern="[a-zA-Z\u00C0-\u01FF'.\-]{2,}"
           type="search" spellcheck="false" required>
    <label for="age">Age:</label>
    <input name="age" id="age" type="number"
           min="16" max="99" style="width: 4em" required>
  </div>

  <!-- ====================================================== -->

  <div class="cols-fr1fr3">
    <label for="years_of_coding">Years of programming computers:</label>
    <input name="years_of_coding" id="years_of_coding" type="number"
           min="0" max="99" style="width: 4em; height: fit-content" required>
  </div>

  <!-- ====================================================== -->

  <div style="margin-top: 1em">
    Self-accessed JavaScript knowledge level:
    <div id="knowledge__slider">
      <input type="range" name="knowledge" list="knowledge-list"
             style="width: 100%" min="0" max="4" value="0">
      <datalist id="knowledge-list">
        <option value="0">Nil</option>
        <option value="1">Basic syntax only</option>
        <option value="2">Can code with an LLM</option>
        <option value="3">Très bien</option>
        <option value="4">I'm Douglas Crockford</option>
      </datalist>
    </div>

  </div>

  <!-- rotate <input> and <datalist> -90° -->
  <style>
    #knowledge__slider {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 10em;
      transform: rotate(-90deg);
      margin-left: 2em;
    }

    #knowledge__slider input { cursor: pointer; }

    #knowledge-list {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      width: 10rem;
      writing-mode: vertical-lr;
    }

    #knowledge-list option {
      cursor: pointer;
      padding: 0.5em 0 0.5em 0;
    }

    #knowledge-list option:hover { background: gold; }
  </style>

  <script type="module">
    let input = document.querySelector('#knowledge__slider input')
    let fn = node => node.onclick = option => input.value = option.target.value
    document.querySelectorAll('#knowledge-list option').forEach(fn)
  </script>

  <!-- ====================================================== -->

  <div id="interests">
    <p>Area of interests:</p>
    <div class="checkboxes">
      <input type="checkbox" id="int_front" name="int" value="frontend">
      <label for="int_front">Frontend</label>
      <input type="checkbox" id="int_back" name="int" value="backend">
      <label for="int_back">Backend</label>
      <input type="checkbox" id="int_other" name="int" value="other">
      <label for="int_other"
             title="E.g., microcontrollers.">Other</label>
    </div>
  </div>

  <style>
    .checkboxes {
      display: grid;
      grid-template-columns: repeat(3, 1.5em 1fr);
      align-items: start;
    }

    .checkboxes input {
      justify-self: left;
    }
  </style>

  <!-- ====================================================== -->

  <div>
    <p>Other languages you program in regularly:</p>
    <div class="checkboxes">
      <input type="checkbox" id="lang_typescript" name="languages" value="typescript">
      <label for="lang_typescript">TypeScript</label>
      <input type="checkbox" id="lang_c" name="languages" value="c/c++">
      <label for="lang_c">C/C++</label>
      <input type="checkbox" id="lang_rust" name="languages" value="rust">
      <label for="lang_rust">Rust</label>
      <input type="checkbox" id="lang_go" name="languages" value="go">
      <label for="lang_go">Go</label>
      <input type="checkbox" id="lang_ruby" name="languages" value="ruby">
      <label for="lang_ruby">Ruby</label>
      <input type="checkbox" id="lang_python" name="languages" value="python">
      <label for="lang_python">Python</label>
      <input type="checkbox" id="lang_php" name="languages" value="php">
      <label for="lang_php">PHP</label>
      <input type="checkbox" id="lang_java" name="languages" value="java">
      <label for="lang_java">Java</label>
      <input type="checkbox" id="lang_swift" name="languages" value="swift">
      <label for="lang_swift">Swift</label>
      <input type="checkbox" id="lang_bash" name="languages" value="bash">
      <label for="lang_bash"
             title="With awk/sed/&c.">Bash</label>
    </div>

    <div class="cols-fr1fr3" style="margin: 0">
      <label for="lang_other" style="padding-left: 0.25em">
        <i>Not listed:</i>
      </label>
      <input name="lang_other" id="lang_other" type="search" spellcheck="false"
             placeholder="Don't add DSLs like SQL.">
    </div>
  </div>

  <!-- ====================================================== -->

  <div>
    <p>Environment:</p>
    <div class="checkboxes">
      <input type="radio" id="env_ide" name="env" value="ide" required>
      <label for="env_ide">IDE</label>
      <input type="radio" id="env_editor" name="env" value="editor">
      <label for="env_editor"
             title="Or another standalone editor.">Emacs/Vim</label>
      <input type="radio" id="env_ed" name="env" value="ed">
      <label for="env_ed"
             title="Ed is the standard text editor.">ed(1)</label>
    </div>
  </div>

  <!-- ====================================================== -->

  <div>
    <p>OS:</p>
    <div class="checkboxes">
      <input type="radio" id="os_linux" name="os" value="linux" required>
      <label for="os_linux">Linux/*BSD</label>
      <input type="radio" id="os_macos" name="os" value="macos">
      <label for="os_macos">macOS</label>
      <input type="radio" id="os_wsl" name="os" value="wsl">
      <label for="os_wsl">WSL</label>
      <input type="radio" id="os_windows" name="os" value="Windows">
      <label for="os_windows">Windows</label>
    </div>
  </div>

  <!-- ====================================================== -->

  <div style="display: flex; flex-direction: column">
    <p>Survey comment:</p>
    <textarea name="comment" maxlength="280" rows="5" style="resize: none"></textarea>
  </div>

  <!-- ====================================================== -->

  <input type="submit" style="margin-top: 2em">

</form>

<script type="module">
  let $$ = document.querySelectorAll.bind(document)
  let url = new URL(window.location.href)
  if (url.searchParams.get('debug') === '1') {
      $$('form *[required]').forEach( node => node.required = false)
  }

  class Interests {
      constructor() {
          this.div = $$('#interests div')[0]
          this.inputs = [...$$('#interests input')]
          let click = node => node.onclick = node => {
              return this.invalid_state(this.valid() ? 'remove' : 'add')
          }
          this.inputs.forEach(click)
      }

      invalid_state(operation) { this.div.classList[operation]('invalid') }

      valid() { return this.inputs.some( node => node.checked) }
  }

  let form = $$('form')[0]
  let interests = new Interests()

  form.onsubmit = evt => {
      if (!interests.valid()) {
          alert('"Area of interests" is unset')
          interests.invalid_state('add')
          return false
      }
  }
</script>
